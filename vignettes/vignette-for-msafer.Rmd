---
title: "Msafer Vignette"
author: "Sifan(Carol) Liu, Kelly Pien, Huiqing(Lily) Jin"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{msafer-vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

Using *msafer* to locate errors when applying `map()` to a list of dataframes.

```{r setup}
library(msafer)
```

## Locating Errors with map_safe_merge() & map_safe()

For demonstration purposes, let's create a sample list of dataframes from the `starwars` and `mtcars` datasets.

```{r}
sample_a <- sample_n(starwars, 34)
sample_a <- subset(sample_a, select = -c(height,hair_color))
sample_b <- sample_n(starwars, 35)
sample_c <- sample_n(mtcars, 20)
sample_c <- subset(sample_c, select = -c(hp))
sample_list <- list(starwars, sample_a, sample_b, sample_c, mtcars)
```

Let's attempt to use `map()` to use a function on all the dataframes in this list.

```{r, error=TRUE}
purrr::map(sample_list, dplyr::select, height)
```

Uh oh! Something didn't work - but what exactly?

`map_safe_merge()` to the rescue! Pass `map_safe_merge()` the same arguments as `map()`: a vector, a function, and parameters that the function needs (if any). `map_safe_merge()` will return a tibble with the file numbers and any errors that may have occurred while trying to apply `map()`.

```{r}
map_safe_merge(sample_list, dplyr::select, height)
```

`map_safe()` is a even better option. Since `map_safe_merge()` only outputs a tibble in the order it was generated, it's hard to quickly identify the error in a huge vector. `map_safe()` nests the error message, and returns a tibble that contains only the unique error message and the index locating where the error occurs within the vector.

```{r}
df <- map_safe(sample_list, dplyr::select, height)
df
```

The column `which_id` in the tibble generated by `map_safe()` is a list of tibbles that contains the location of the elements related to the result. To show it or compute with it, use the following method:

Which_id is always the 3rd column in the tibble generated by `map_safe()`.
```{r}
df[[3]][[1]]
```
The result shows that in list a which contains 3 datasets, the first and the second dataset contains column `height`, whereas the third dataset does not, causing the error "Error in .f(.x[[i]], ...): object 'height' not found". 

You can also pass in just one dataframe. `map_safe_merge()` will return whether or not the specified function can be applied to each column in the dataframe.

```{r}
map_safe_merge(iris, log)
```

If you pass in one vector, `map_safe_merge()` will return whether or not the specified function can be applied to each row.

```{r}
map_safe(iris, log)
```

```{r}
map_safe_merge(iris$Sepal.Length, log)
```

```{r}
map_safe(iris$Sepal.Length, log)
```

`map_safe()` and `map_safe_merge()` can be used based on user's preference and how they want to use the output. 

Another function within the msafer package is the `check_match()` function which identified whether the userâ€™s requirement existed within the dataset, if yes, then the function will return true, if not, it returns false.

```{r}
# when working with one dataframe
check_match(starwars, hair_color == "brown")
```
We can see that as starwars does contain brown hair color, thus the function returns true. 

## map_safe_merge() x check_match()
You can also use `map_safe_merge()` in conjunction with `check_match()`.
```{r}
s <- map_safe(dplyr::starwars, check_match, height==0)
s
```



# Conclusion
The flagship function of *msafer*, `map_safe()`, can identify on which files errors occur when applying `map()` to a list of dataframes.
