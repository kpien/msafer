---
title: "Msafer Vignette"
author: "Sifan(Carol) Liu, Kelly Pien, Huiqing(Lily) Jin"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{msafer-vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

How to use *msafer* to locate errors when applying `map()` to a list of dataframes.

```{r setup}
library(msafer)
```

## Locating Errors with map_safe_merge()

For demonstration purposes, let's create a sample list of dataframes from the `starwars` and `mtcars` datasets.

```{r}
sample_a <- dplyr::sample_n(dplyr::starwars, 34)
sample_b <- dplyr::sample_n(mtcars, 1:20)
a <- list(dplyr::starwars, sample_a, sample_b)
```

Let's attempt to use `map()` to use a function on all the dataframes in this list.

```{r, error=TRUE}
purrr::map(a, dplyr::select, height)
```

Uh oh! Something didn't work - but what exactly?

`map_safe_merge()` to the rescue! Pass `map_safe_merge()` the same arguments as `map()`. `map_safe_merge()` will return a tibble with the file numbers and any errors that may have occurred while trying to apply `map()`, grouping repeat errors together.

```{r}
map_safe_merge(a, dplyr::select, height)
```

You can also pass in just one dataframe. `map_safe_merge()` will return whether or not the specified function can be applied to each column in the dataframe.

```{r}
map_safe_merge(iris, log)
```

If you pass in one vector, `map_safe_merge()` will return whether or not the specified function can be applied to each row.
```{r}
map_safe_merge(iris$Sepal.Length, log)
```

# Conclusion
The flagship function of *msafer*, `map_safe_merge()`, can identify on which files errors occur when applying `map()` to a list of dataframes.

```{r}
# setwd("~/Downloads")
# mydir = "myfiles"
# file_list = list.files(path=mydir, pattern="*.csv", full.names=TRUE)
# file_list
# myfiles = lapply(file_list,read_csv)
# map_safe_merge(myfiles, select, pO2)
# map_safe_merge(myfiles, check_match, height==0)
```
