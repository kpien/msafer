---
title: "map_safe()"
author: "Kelly Pien, Lily Jin, Carol Liu"
date: "11/29/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(purrr)
library(dplyr)
library(readr)
```

```{r}
#always returns logical vector
#another function
#if map_safe returns all TRUE, else different behaviors: only return good results

map_safe <- function(.x, f, ...) {
  # .x: vector of paths to csvs
  # f: function that's being applied to the dataset
  # ... arguments
  if (length(.x) == 1) {
    #if there is one row in .x: get and return the row number
    a <- tryCatch(
      {
        #This is the try part
        map(.x, f, ...)
        TRUE
      },
      error = function(e) {
        message("Something went wrong")
        message("Here's the original error message")
        message(e)
        return(FALSE)
      },
      warning=function(w) {
        message("Here's the original warning message:")
        message(w)
            # Choose a return value in case of warning
        return(TRUE)
      }
      )
    return(a)
    }
  else {
    # else, split in halves and run map_safe on each half
    a <- .x[1] # Take the first element in the vector
    b <- .x[2:length(.x)] # the remaining elements went through the recursion again
    return(c(map_safe(a, f, ...), map_safe(b, f, ...)))
  }
}
```

```{r}
sample_a <- sample_n(starwars, 34)
sample_b <- sample_n(mtcars, 1:20)
a <- list(starwars, sample_a, sample_b)
```


```{r}
map_safe(a, select, height)
```

```{r}
setwd("~/Desktop")
mydir = "file_for_carol"
file_list = list.files(path=mydir, pattern="*.csv", full.names=TRUE)
file_list
myfiles = lapply(file_list,read_csv)
```

```{r}
map(myfiles, file_good, height)
```

```{r}
map(myfiles, select, pO2)
```

```{r, warning=FALSE}
map_safe(myfiles, select, pO2)
```

```{r, warning=FALSE}
map_safe(starwars$height, log)
```
View(starwars)

```{r, error=FALSE}
map_safe(starwars$name, log)
````


```{r}
file_good <- function(.data, ...){
  # Using `dplyr::filter()` to get the rows that matches the user's need and store them into row.
  row <- .data %>%
    filter(...)%>%
    # Count the number of rows that matches the user's need.
    nrow()
  # Return TRUE if the rows that matches the need is greater than 0, else return FALSE
  isTRUE(row > 0)
}
```

